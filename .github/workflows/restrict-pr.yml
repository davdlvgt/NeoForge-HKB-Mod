name: Restrict PRs

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  check-branch-rules:
    runs-on: ubuntu-latest
    steps:
      - name: Check branch rules
        run: |
          BASE="${{ github.event.pull_request.base.ref }}"
          HEAD="${{ github.event.pull_request.head.ref }}"

          echo "üö¶ PR ge√∂ffnet: $HEAD -> $BASE"

          # Regeln f√ºr master
          if [[ "$BASE" == "master" ]]; then
            if [[ "$HEAD" != "release" ]]; then
              echo "‚ùå Fehler: Nur release darf in master gemerged werden!"
              exit 1
            fi
          fi

          # Regeln f√ºr release
          if [[ "$BASE" == "release" ]]; then
            if [[ "$HEAD" != "master" && "$HEAD" != "dev" ]]; then
              echo "‚ùå Fehler: Nur master oder dev d√ºrfen in release gemerged werden!"
              exit 1
            fi
          fi

          # Regeln f√ºr dev
          if [[ "$BASE" == "dev" ]]; then
            if [[ "$HEAD" != "release" && ! "$HEAD" =~ ^(feature/|fix/|hotfix/|bugfix/|experiment/|chore/|docs/|test/|cicd/) ]]; then
              echo "‚ùå Fehler: Nur release oder feature/*, fix/*, hotfix/*, bugfix/*, experiment/*, chore/*, docs/*, test/*, cicd/* d√ºrfen in dev gemerged werden!"
              exit 1
            fi
          fi

          echo "‚úÖ Regeln eingehalten: Merge erlaubt."
